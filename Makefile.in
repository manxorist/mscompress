CC = @CC@
CFLAGS = @CFLAGS@


VERS   = @VERSION@
OSTYPE = @OS_TYPE@

OUTDIR=$(PWD)/..
SRCDIR=$(PWD)


all:	mscompress msexpand

clean:
	rm -f *~ *.o core mscompress msexpand
	cd test; make clean

mrproper:	clean
	rm -f config.log config.status config.h config.cache Makefile

test:	all
	cd test; make test

install:	all
	mkdir -p $(BUILDROOT)/usr/bin
	mkdir -p $(BUILDROOT)/usr/man/man1
	@INSTALL@ -c -s -m 0755 -o root -g root mscompress $(BUILDROOT)/usr/bin
	@INSTALL@ -c -s -m 0755 -o root -g root msexpand $(BUILDROOT)/usr/bin
	@INSTALL@ -c -m 0644 -o root -g root msexpand.1 $(BUILDROOT)/usr/man/man1
	@INSTALL@ -c -m 0644 -o root -g root mscompress.1 $(BUILDROOT)/usr/man/man1
	@echo installing entry to /usr/lib/magic ...
	@/bin/sh ./magic.add $(BUILDROOT)

binary: install
	@echo Creating binary .tar.bz2 in directory $(OUTDIR)/
	cd $(BUILDROOT)/ ; tar cf $(OUTDIR)/mscompress-$(VERS)-$(OSTYPE).tar `cat $(SRCDIR)/binfiles`
	bzip2 -9f $(OUTDIR)/mscompress-$(VERS)-$(OSTYPE).tar

mscompress:	mscompress.o version.o
	$(CC) -o mscompress mscompress.o version.o

msexpand:	msexpand.o version.o
	$(CC) -o msexpand msexpand.o version.o
